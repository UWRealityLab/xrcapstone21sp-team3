<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>Event Horizon</title>

        <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
        <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v6.1.1/dist/aframe-extras.min.js"></script>
        <script src="https://rawgit.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
        <script src="https://unpkg.com/aframe-physics-extras/dist/aframe-physics-extras.min.js"></script>
        <script src="https://unpkg.com/super-hands@^3.0.1/dist/super-hands.min.js"></script>
    
        <!-- https://croquet.studio/sdk/docs/index.html -->
        <script src="https://unpkg.com/@croquet/croquet@0.4.0"></script>
    
        <!-- https://croquet.studio/sdk/docs/global.html#Constants -->
        <script src="thirdparty/constants.js"></script>
    
        <!-- Here we register the croquet system/component immediately before the scene loads -->
        <script src="thirdparty/system.js"></script>
        <script src="thirdparty/component.js"></script>
    
        <!-- Modules are loaded after the document (and therefore A-Frame scene) loads  -->
        <script src="thirdparty/index.js" type="module"></script>
        <script src="thirdparty/aframe-super-shooter-kit.min.js"></script>

        <script src="scripts/grab-to-shoot.js"></script>
        <script src="scripts/hit-handler.js"></script>
        <script src="scripts/button-press.js"></script>
        <script src="scripts/slideshow.js"></script>
        <script src="scripts/spring.js"></script>
        <script src="scripts/show-spring.js"></script>
    </head>
    <body>
        <a-scene physics="gravity:-1.62" cursor="rayOrigin: mouse" croquet>
            <a-assets>
                <img id="sky-box" src="assets/images/space.jpg"></img>
                <img id="arrow" src="assets/images/arrow.jpg"></img>
                <img id="floor-plan-1" src="assets/images/room1.png"></img>
                <img id="floor-plan-2" src="assets/images/room2.png"></img>
                <img id="floor-plan-3" src="assets/images/room3.png"></img>
                <img id="floor-plan-4" src="assets/images/room4.png"></img>
                <img id="floor-plan-5" src="assets/images/room5.png"></img>

                <a-asset-item id="map" src="assets/models/map.glb"></a-asset-item>
                <a-asset-item id="terminal-1" src="assets/models/terminal_1.glb"></a-asset-item>
                <a-asset-item id="monitor" src="assets/models/monitor.glb"></a-asset-item>
            </a-assets>

            <!-- PLAYER -->

            <template id="userTemplate">
                <a-entity class="user">
                    <a-gltf-model
                        src="https://cdn.glitch.com/ebbea273-4dc0-4e45-98a9-1e7536d9ffeb%2FCesiumMan.gltf?v=1618458256256"
                        id="cameraHead"
                        class="head"
                        scale="1.3 1.3 1.3"
                        position="0 -1.7 0"
                        rotation="-10 180 0"
                    ></a-gltf-model>
                </a-entity>
            </template>

            <!-- human start: 0 0 -20 -->
            <!-- robot start: 16 0 0 -->
            <a-entity
                id="camera"
                navigator="cameraRig: #camera; cameraHead: #head; collisionEntities: .collision; ignoreEntities: .clickable"
                position="16 0 0"
                rotation="0 0 0"
                movement-controls
            >
                <a-entity
                    id="head"
                    camera="active: true"
                    position="0 1 0"
                    look-controls
                ></a-entity>
    
                <a-entity
                    id="rightHand"
                    super-hands
                    hand-controls="hand: right; handModelStyle: highPoly; color: #afafaf"
                    sphere-collider="objects: a-sphere, a-box"
                    visible="true"
                    raycaster="objects: .clickable"
                    static-body="shape: sphere; sphereRadius: 0.02"
                    physics-collider
                ></a-entity>
    
                <a-entity
                    id="leftHand"
                    super-hands
                    hand-controls="hand: left; handModelStyle: highPoly; color: #afafaf"
                    sphere-collider="objects: a-sphere, a-box"
                    teleport-controls="cameraRig: #camera; teleportOrigin: #head; button: trigger; hitCylinderColor: #7a96ea; curveHitColor: #7a96ea; curveNumberPoints: 5000; curveShootingSpeed:18; landingMaxAngle: 60"
                    visible="true"
                    raycaster="objects: .clickable"
                    static-body="shape: sphere; sphereRadius: 0.02"
                    physics-collider
                ></a-entity>
            </a-entity>

            <!-- SCENE -->

            <a-sky croquet="name: sky;" src="#sky-box"></a-sky>
            
            <a-light croquet="name: dLight1" type="directional" intensity="0.5" position="1 0 0"></a-light>
            <a-light croquet="name: dLight2" type="directional" intensity="0.5" position="-1 0 0"></a-light>
            <a-light croquet="name: dLight3" type="directional" intensity="0.5" position="0 1 0"></a-light>
            <a-light croquet="name: dLight4" type="directional" intensity="0.5" position="0 -1 0"></a-light>
            <a-light croquet="name: dLight5" type="directional" intensity="0.5" position="0 0 1"></a-light>
            <a-light croquet="name: dLight6" type="directional" intensity="0.5" position="0 0 -1"></a-light>

            <a-gltf-model croquet="name: map;" src="#map" position="0 0 0" rotation="0 90 0">
                <a-plane croquet="name: floor;" static-body position="0 0.1 0" rotation="-90 0 0" width="60" height="60" material="opacity:0"></a-plane>
                <a-plane croquet="name: wall-1;" static-body position="-15.35 0 16" rotation="0 90 0" width="10" height="10" material="opacity:0"></a-plane>

                <!-- HUMAN START -->

                <!-- sealer objects -->
                <a-entity croquet="name: foam;" id="bulletTemplate" bullet geometry="primitive: sphere; radius: 0.1" material="color: white"></a-entity>
                <a-entity croquet="name: target;" class="target" target="healthPoints: 10" geometry="primitive: box" material="color: teal" position="0 0 -4" hit-handler static-body></a-entity> 
                <a-cylinder croquet="name: sealer;" id="sealer" geometry="height: 0.25; radius: 0.05" color="#add8e6" dynamic-body grabbable shooter grab-to-shoot position="5 -1 0"></a-cylinder>

                <!-- ROBOT START -->

                <!-- terminal -->
                <a-gltf-model croquet="name: terminal-1;" src="#terminal-1" position="-9.75 0 19.5" scale="0.01 0.01 0.01">
                    <!-- left button -->
                    <a-box hoverable button-press="direction: left" color="#006e9e" position="12 137 3" rotation="0 0 180" scale="20 25 5">
                        <a-plane src="#arrow" position="0 0 -0.52" rotation="0 180 0" width="1" height="1"></a-plane>
                    </a-box>
                    <!-- right button -->
                    <a-box hoverable button-press="direction: right" color="#006e9e" position="-12 137 3" scale="20 25 5">
                        <a-plane src="#arrow" position="0 0 -0.52" rotation="0 180 0" width="1" height="1"></a-plane>
                    </a-box>
                </a-gltf-model>
                
                <!-- monitor -->
                <a-gltf-model croquet="name: monitor;" src="#monitor" position="-15.5 1 16" rotation="0 90 0" scale="0.075 0.075 0.075">
                    <a-plane slideshow src="#floor-plan-1" position="0 18.5 2.2" width="60" height="30"></a-plane>
                    <a-box id="tv-wire-start" static-body position="0 -1 1" scale="3 3 3" color="black"></a-box>
                    <a-box id="tv-wire-end" grabbable 
                           spring="target: #tv-wire-start; stiffness: 5; damping: 10" 
                           dynamic-body="linearDamping: 0.9; angularDamping: 0.9" 
                           position="1 -9 11" scale="3 3 3" color="white"
                    ></a-box>
                    <a-entity show-spring="start: tv-wire-start; end: tv-wire-end" line="color: black"></a-entity>
                </a-gltf-model>

                <!-- wire -->
                <a-box position="2 3 17" scale="0.5 0.5 0.5" id="stationary" color="blue" static-body></a-box>
                <a-box grabbable position="2 2 17" scale="0.5 0.5 0.5" id="swing" color="green" dynamic-body="linearDamping: 0.9; angularDamping: 0.9" spring="target: #stationary"></a-box>
                <a-entity show-spring="start: stationary; end: swing" line="color: red"></a-entity>

            </a-gltf-model>

        </a-scene>
    </body>

    <script src="thirdparty/randomizeLocation.js"></script>
</html>
