<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>Event Horizon</title>

        <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
        <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v6.1.1/dist/aframe-extras.min.js"></script>
        <script src="https://rawgit.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
        <script src="https://unpkg.com/aframe-physics-extras/dist/aframe-physics-extras.min.js"></script>
        <script src="https://unpkg.com/super-hands@^3.0.1/dist/super-hands.min.js"></script>

        <!-- https://croquet.studio/sdk/docs/index.html -->
        <script src="https://unpkg.com/@croquet/croquet@0.4.0"></script>

        <!-- https://croquet.studio/sdk/docs/global.html#Constants -->
        <script src="thirdparty/constants.js"></script>

        <!-- Here we register the croquet system/component immediately before the scene loads -->
        <script src="thirdparty/system.js"></script>
        <script src="thirdparty/component.js"></script>

        <!-- Modules are loaded after the document (and therefore A-Frame scene) loads  -->
        <script src="thirdparty/index.js" type="module"></script>
        <script src="thirdparty/aframe-super-shooter-kit.min.js"></script>

        <script src="https://cdn.jsdelivr.net/gh/oneWaveAdrian/aframe-particle-system-component@aframe-1.2.0-upgrade/dist/aframe-particle-system-component.min.js"></script>

        <script src="scripts/grab-to-shoot.js"></script>
        <script src="scripts/hit-handler.js"></script>
        <script src="scripts/button-press.js"></script>
        <script src="scripts/slideshow.js"></script>
        <script src="scripts/show-spring.js"></script>
        <script src="scripts/plug-in.js"></script>
        <script src="scripts/light-switch.js"></script>
        <script src="scripts/turn-off-lights.js"></script>
    </head>
    <body>
        <a-scene physics="gravity:-1.62" cursor="rayOrigin: mouse" croquet>
            <a-assets>
                <img id="sky-box" src="assets/images/space.jpg"></img>
                <img id="arrow" src="assets/images/arrow.jpg"></img>
                <img id="floor-plan-1" src="assets/images/room1.png"></img>
                <img id="floor-plan-2" src="assets/images/room2.png"></img>
                <img id="floor-plan-3" src="assets/images/room3.png"></img>
                <img id="floor-plan-4" src="assets/images/room4.png"></img>
                <img id="floor-plan-5" src="assets/images/room5.png"></img>

                <a-asset-item id="map" src="assets/models/map.glb"></a-asset-item>
                <a-asset-item id="terminal-1" src="assets/models/terminal_1.glb"></a-asset-item>
                <a-asset-item id="monitor" src="assets/models/monitor.glb"></a-asset-item>
                <a-asset-item id="crate_a" src="assets/models/crate_a.glb"></a-asset-item>
                <a-asset-item id="crate_b" src="assets/models/crate_b.glb"></a-asset-item>
                <a-asset-item id="pipe_c" src="assets/models/pipeline_c.glb"></a-asset-item>
                <a-asset-item id="door_a" src="assets/models/door_a.glb"></a-asset-item>

                <a-asset-item id="human" src="assets/models/humanHead.glb"></a-asset-item>
                <a-asset-item id="robot" src="assets/models/robotHead.glb"></a-asset-item>
            </a-assets>

            <!-- PLAYER -->

            <template id="humanTemplate">
                <a-entity class="user" dynamic-body>
                    <a-gltf-model
                        src="#human"
                        id="cameraHead"
                        class="head"
                        scale="1.5 1.5 1.5"
                        position="0 -0.75 0"
                        rotation="-10 180 0"
                    ></a-gltf-model>
                </a-entity>
            </template>

            <template id="robotTemplate">
                <a-entity class="user" dynamic-body>
                    <a-gltf-model
                        src="#robot"
                        id="cameraHead"
                        class="head"
                        scale="0.5 0.5 0.5"
                        position="0 0 0"
                        rotation="-10 180 0"
                    >
                    </a-gltf-model>
                </a-entity>
            </template>

            <!-- human start: 0 0 -20 -->
            <!-- robot start: 16 0 0 -->
            <a-entity
                id="camera"
                navigator="cameraRig: #camera; cameraHead: #head; collisionEntities: .collision; ignoreEntities: .clickable"
                position="16 0 0"
                rotation="0 0 0"
                movement-controls
            >
                <a-entity
                    id="head"
                    camera="active: true"
                    position="0 1 0"
                    look-controls
                ></a-entity>

                <a-entity
                    id="rightHand"
                    super-hands="colliderEvent: raycaster-intersection; colliderEventProperty: els; colliderEndEvent: raycaster-intersection-cleared; colliderEndEventProperty: clearedEls"
                    laser-controls
                    hand-controls="hand: right; handModelStyle: highPoly; color: #afafaf"
                    sphere-collider="objects: a-sphere, a-box"
                    visible="true"
                    static-body="shape: sphere; sphereRadius: 0.02"
                    physics-collider
                ></a-entity>
    
                <a-entity
                    id="leftHand"
                    super-hands
                    hand-controls="hand: left; handModelStyle: highPoly; color: #afafaf"
                    sphere-collider="objects: a-sphere, a-box"
                    teleport-controls="collisionEntities: #floorgeometry; cameraRig: #camera; teleportOrigin: #head; button: trigger; hitCylinderColor: #7a96ea; curveHitColor: #7a96ea; interval: 20;"
                    visible="true"
                    raycaster="objects: .clickable"
                    static-body="shape: sphere; sphereRadius: 0.02"
                    physics-collider
                ></a-entity>
            </a-entity>

            <!-- SCENE -->

            <a-sky croquet="name: sky;" src="#sky-box"></a-sky>

            <a-light croquet="name: dLight1" type="directional" intensity="0.5" position="1 0 0" turn-off-lights></a-light>
            <a-light croquet="name: dLight2" type="directional" intensity="0.5" position="-1 0 0" turn-off-lights></a-light>
            <a-light croquet="name: dLight3" type="directional" intensity="0.5" position="0 1 0" turn-off-lights></a-light>
            <a-light croquet="name: dLight4" type="directional" intensity="0.5" position="0 -1 0" turn-off-lights></a-light>
            <a-light croquet="name: dLight5" type="directional" intensity="0.5" position="0 0 1" turn-off-lights></a-light>
            <a-light croquet="name: dLight6" type="directional" intensity="0.5" position="0 0 -1" turn-off-lights></a-light>

            <a-gltf-model croquet="name: map;" src="#map" position="0 0 0" rotation="0 90 0">
                <a-entity id="floorgeometry" croquet="name: floorgeometry;">
                    <a-entity position="0 0 -2.5" rotation="0 90 0" geometry="primitive: box; depth: 8.5; height: 0.5; width: 28"
                              material="opacity: 0" static-body>
                    </a-entity>
                    <a-entity position="4.5 0 16" geometry="primitive: box; depth: 8.5; height: 0.5; width: 40"
                              material="opacity: 0" static-body>
                    </a-entity>
                    <a-entity position="4.5 0 -21"geometry="primitive: box; depth: 9.5; height: 0.5; width: 40"
                              material="opacity: 0" static-body>
                    </a-entity>
                    <a-entity position="20 0 6" rotation="0 90 0" geometry="primitive: box; depth: 8.5; height: 0.5; width: 28"
                              material="opacity: 0" static-body>
                    </a-entity>
                    <a-entity position="22.5 0 -12" rotation="0 90 0" geometry="primitive: box; depth: 4.5; height: 0.5; width: 8"
                              material="opacity: 0" static-body>
                    </a-entity>
                </a-entity>

                <a-plane croquet="name: floor;" static-body position="0 0.1 0" rotation="-90 0 0" width="60" height="60" material="opacity:0"></a-plane>
                <a-plane croquet="name: wall-1;" static-body position="-15.35 0 16" rotation="0 90 0" width="10" height="10" material="opacity:0"></a-plane>

                <!-- HUMAN START -->

                <!-- sealer objects -->
                <a-entity id="bulletTemplate" bullet="maxTime: 0.25" geometry="primitive: sphere; radius: 0.25" material="color: white; opacity: 1"></a-entity>

                <a-entity class="target" id="foamTarget" target="healthPoints: 5" geometry="primitive: box; depth: 0.1" material="opacity: 0" position="24.5 3 -2.9" rotation="0 -90 0" static-body>
                    <a-entity position="0 -2 -.5" hit-handler particle-system="preset: default; color: #ffffff,#000000; texture: https://raw.githubusercontent.com/IdeaSpaceVR/aframe-particle-system-component/master/dist/images/cloudSml.png; accelerationValue: 0 0 0; accelerationSpread: 10 10 0; velocityValue: 0 0 -10; velocitySpread: 7 7 3.5; maxAge: 1; size: 1; maxParticleCount: 1000; opacity: 0.25"></a-entity>
                    <a-plane rotation="0 0 20" position="0 -2 -.25" material="color: #ffffff; opacity:0.9" geometry="width:1; height:0.01"></a-plane>
                    <a-plane rotation="0 0 -20" position="0 -2 -.25" material="color: #ffffff; opacity:0.9" geometry="width:0.4; height:0.01"></a-plane>
                    <a-plane rotation="0 0 -10" position="0 -2 -.25" material="color: #ffffff; opacity:0.9" geometry="width:0.1; height:0.01"></a-plane>
                    <a-plane rotation="0 0 10" position="0 -2 -.25" material="color: #ffffff; opacity:0.9" geometry="width:0.3; height:0.01"></a-plane>
                    <a-plane rotation="0 0 -30" position="0 -2 -.25" material="color: #ffffff; opacity:0.9" geometry="width:0.2; height:0.01"></a-plane>
                </a-entity>
                <a-cylinder croquet="name: sealer;" dynamic-body id="sealer" geometry="height: 0.25; radius: 0.05" color="#add8e6" grabbable="endButtons: gripup; maxGrabbers:1" shooter grab-to-shoot position="20 0.25 0">
                    <a-entity id="sealantParticle" particle-system="preset: default; color: #ffffff; texture: https://raw.githubusercontent.com/IdeaSpaceVR/aframe-particle-system-component/master/dist/images/smokeparticle.png; accelerationValue: 0 0 0; accelerationSpread: 0 0 0; velocityValue: 0 0 -2; velocitySpread: 1 1 0.5; maxAge: 1; size: 0.5; maxParticleCount: 500; opacity: 0.5; enabled: false"></a-entity>
                </a-cylinder>

                <!-- flashlight -->
                <a-cylinder croquet="name: flashLight;" dynamic-body id="flashlight" geometry="height: 0.25; radius: 0.05" color="#808080" grabbable="endButtons: gripup; maxGrabbers: 1" position="20 0.25 3">
                    <a-entity geometry="primitive: sphere; radius: 0.05" light="type: spot; intensity: 0; angle: 30; distance: 10; decay: 2" position="0 -0.12 0" rotation="-90 0 0" light-switch></a-entity>
                </a-cylinder>

                <!-- ROBOT START -->

                <!-- terminal -->
                <a-gltf-model croquet="name: terminal-1;" src="#terminal-1" position="-9.75 0 19.5" scale="0.01 0.01 0.01">
                    <!-- left button -->
                    <a-box hoverable button-press="direction: left" color="#006e9e" position="12 137 3" rotation="0 0 180" scale="20 25 5">
                        <a-plane src="#arrow" position="0 0 -0.52" rotation="0 180 0" width="1" height="1"></a-plane>
                    </a-box>
                    <!-- right button -->
                    <a-box hoverable button-press="direction: right" color="#006e9e" position="-12 137 3" scale="20 25 5">
                        <a-plane src="#arrow" position="0 0 -0.52" rotation="0 180 0" width="1" height="1"></a-plane>
                    </a-box>
                    <!-- outlet -->
                    <a-plane position="0 26 -11" rotation="0 180 0" width="20" height="20" color="white">
                        <a-plane position="4 0 0.1" width="4" height="12" color="black"></a-plane>
                        <a-plane position="-4 0 0.1" width="4" height="12" color="black"></a-plane>
                    </a-plane>
                </a-gltf-model>
                
                <!-- monitor -->
                <a-gltf-model croquet="name: monitor;" src="#monitor" position="-15.5 1 16" rotation="0 90 0" scale="0.075 0.075 0.075">
                    <a-plane slideshow src="#floor-plan-1" position="0 18.5 2.2" width="60" height="30"></a-plane>
                    <a-box id="tv-wire-start" static-body position="-0.5 -1 1" scale="3 3 3" color="black"></a-box>
                    <a-box id="tv-wire-end" grabbable
                           dynamic-body="linearDamping: 0.9; angularDamping: 0.9"
                           spring="target: #tv-wire-start; stiffness: 5; damping: 10"
                           position="1 -9 11" scale="2.5 2.5 2.5" color="white"
                    >
                        <a-box position="0.2 0 0.75" scale="0.2 0.6 0.5" color="grey"></a-box>
                        <a-box position="-0.2 0 0.75" scale="0.2 0.6 0.5" color="black"></a-box>
                    </a-box>
                    <a-entity show-spring="start: #tv-wire-start; end: #tv-wire-end" line="color: black"></a-entity>
                </a-gltf-model>

                <!-- wire -->
                <a-box id="stationary" body="type: static" position="2 3 17" scale="0.5 0.5 0.5" color="blue"></a-box>
                <a-box id="swing" plug-in="target: #bottom" grabbable spring="target: #stationary" body="type: dynamic; linearDamping: 0.9; angularDamping: 0.9" position="2 2 17" scale="0.5 0.5 0.5" color="green"></a-box>
                <a-entity show-spring="start: #stationary; end: #swing" line="color: red"></a-entity>
                <a-box id="bottom" static-body position="2 1 17" scale="0.5 0.5 0.5" color="grey"></a-box>

                <!--items to hide terminal and monitor, comment these out if you want to use them-->
                <!--TODO: add "dynamic body" attribute to all of these when map loads faster (they just fall through space if i do that rn)-->
                <a-gltf-model hoverable grabbable croquet="name: crate_a0;" src="#crate_a" position="-14.5 0.2 18" rotation="0 90 0" scale="1.5 1.5 1.5">
                </a-gltf-model>
                <a-gltf-model hoverable grabbable croquet="name: crate_a1;" src="#crate_a" position="-14.5 0.2 15.6" rotation="0 90 0" scale="1.5 1.5 1.5">
                </a-gltf-model>
                <a-gltf-model hoverable grabbable croquet="name: crate_a2;" src="#crate_a" position="-14.5 1.4 17.5" rotation="0 90 0" scale="1.5 1.5 1.5">
                </a-gltf-model>
                <a-gltf-model hoverable grabbable croquet="name: crate_a3;" src="#crate_a" position="-14.5 1.4 15.1" rotation="0 90 0" scale="1.5 1.5 1.5">
                </a-gltf-model>
                <a-gltf-model hoverable grabbable croquet="name: crate_a4;" src="#crate_a" position="-13.5 0.2 13.65" scale="1.5 1.5 1.5">
                </a-gltf-model>
                <a-gltf-model hoverable grabbable croquet="name: pipe_c0;" src="#pipe_c" position="-14.5 2.8 15.6" rotation="90 0 0" scale="1.5 1.5 1.5">
                </a-gltf-model>
                <a-gltf-model hoverable grabbable croquet="name: pipe_c1;" src="#pipe_c" position="-13.5 1.6 13.65" rotation="0 0 90" scale="1.5 1.5 1.5">
                </a-gltf-model>
                <a-gltf-model hoverable grabbable croquet="name: crate_b0;" src="#crate_b" position="-10.7 0.1 19" rotation="0 90 0" scale="0.7 0.7 0.7">
                </a-gltf-model>
                <a-gltf-model hoverable grabbable croquet="name: crate_b1;" src="#crate_b" position="-10.7 0.9 19" rotation="0 90 0" scale="0.7 0.7 0.7">
                </a-gltf-model>
                <a-gltf-model hoverable grabbable croquet="name: crate_b2;" src="#crate_b" position="-10.7 1.7 19" rotation="0 90 0" scale="0.7 0.7 0.7">
                </a-gltf-model>
                <a-gltf-model hoverable grabbable croquet="name: pipe_c2;" src="#pipe_c" position="-9 1 19.4" rotation="0 90 0" scale="1.8 1.8 1.8">
                </a-gltf-model>
                <a-gltf-model hoverable grabbable croquet="name: pipe_c2;" src="#pipe_c" position="-8.5 1 19.4" rotation="0 90 0" scale="1.8 1.8 1.8">
                </a-gltf-model>
                <a-gltf-model hoverable grabbable croquet="name: door_a;" src="#door_a" position="-9.3 0.1 19" scale="0.6 0.6 0.6">
                </a-gltf-model>

            </a-gltf-model>

        </a-scene>
    </body>
</html>
